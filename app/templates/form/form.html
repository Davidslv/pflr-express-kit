{% extends "templates/app/app.html" %}
{% from 'components/ErrorSummary/ErrorSummary.njk' import ErrorSummary with context %}

{% block stylesheet %}
<link href="/public/stylesheets/govuk-form-styles.css" rel="stylesheet">
{{ super() }}
{% endblock %}

{% block grid_content_body %}
{# app.wizard.steps.count - {{ app.wizard.steps.count }}
{% if app.wizard.steps.count > 1 and route.template != 'step-by-step' %}
<a class="link-back" href="{{ getRouteUrl(wizard.stepsFlat[app.wizard.steps.count - 1]) }}">Back</a>
{% endif %} #}
{{ ErrorSummary(errors) }}
<form method="post">
{{ super() }}
{% set startPage = route.start %}
<div class="xform-group form-submit">

{% set formContinue = 'Save and continue' %}
{% if startPage %}{% set formContinue = 'Start' %}{% endif %}
{% if route.continue %}{% set formContinue = 'Continue' %}{% endif %}
<button class="button {% if startPage %}button-start {% endif %}next validation-submit" type="submit">{{ formContinue }}</button>
{% if route.multiple_counter %}
{% set addValue = 1 %}
{% if autofields[route.multiple_counter] %}{% set addValue = autofields[route.multiple_counter] %}{% endif %}
{% set addValue = addValue + 1 %}
{% if route.multiple_max >= addValue %}{% if route._index == addValue - 1 %}
<button class="button button--add" type="submit" name="{{ route.multiple_counter }}" value="{{ addValue }}">{{ getFormattedProp(route.id, 'multiple_add', 'Add another') }}</button>
{% endif %}
{% endif %}
{% if autofields[route.multiple_counter] > route.multiple_min %}
  {% if autofields[route.multiple_counter] ==  route._index %}
<buttton class="button button--delete button--destructive">{{ getFormattedProp(route.id, 'multiple_delete', 'Delete') }}</button>
  {% endif %}
{% endif %}
{% endif %}

</div>

</form>
{% endblock %}

{% block body_end %}
{{ super() }}
<script>
function unsetCheckbox(inputs) {
  inputs.prop('checked', false)
  inputs.closest('label').removeClass('selected')
}
jQuery('[data-excludes] input').on('change', function(){
  if (this.checked) {
    var inputs = jQuery(this).closest('fieldset').find('> label > input').not(this)
    unsetCheckbox(inputs)
  }
}).closest('fieldset').find('> label > input').not('[data-excludes] input').on('change', function(){
  if (this.checked) {
    var inputs = jQuery(this).closest('fieldset').find('> label[data-excludes] > input')
    unsetCheckbox(inputs)
  }
})
jQuery('input[type=radio][aria-controls]').each(function(){
//on('change', function() {
  var $this = jQuery(this)
  var name = $this.attr('name')
  var controls = $this.attr('aria-controls')
  var revealsId = this.id
  var $controls = jQuery('#' + controls)
  jQuery('input[name="' + name + '"]').on('change', function(){
    var state = this.id === revealsId
    var classMethod = state ? 'removeClass' : 'addClass'
    var ariaHidden = state ? 'false' : 'true'
    $controls[classMethod]('js-hidden')
    $controls.attr('aria-hidden', ariaHidden)
    console.log(controls, state)
  })
  //console.log($this.attr('aria-controls'), $this.attr('name'))
})
</script>
{% endblock %}
