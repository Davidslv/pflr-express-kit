{% from '../BlockHeading/BlockHeading.njk' import BlockHeading with context %}
{% from '../Control/Control.njk' import Control with context %}
{% macro Group(name='', heading='', blocks=[]) %}
<div{% if name %} data-block-name="{{name}}"{% endif %}>
{#{{ BlockHeading(name, heading=heading) }}#}
{% if name %}
{% set blocks = getBlockProp(name, 'blocks') %}
{% endif %}
{% for block in blocks %}
  {% set blockType = block._blockType %}
  {% set blockData = block.data %}
  {% if not blockType %}
    {% set blockType = getBlockProp(block, '_blockType') %}
    {% set blockData = block %}
  {% endif %}
  {% if blockType %}
    {% if Block[blockType] %}
    {#{% call Block[blockType](blockData) %}{% endcall %}#}
    {{ Block[blockType](blockData) }}
    {% else %}
    <p>NO SUCH MACRO : {{ blockType }}:</p>
    {% endif %}
  {% else %}
  {#{% call Control(block) %}{% endcall %}#}
  {{ Control(block) }}
  {% endif %}
{% endfor %}
</div>
{% endmacro %}